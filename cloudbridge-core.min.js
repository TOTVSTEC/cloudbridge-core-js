"use strict";function QObject(a,b,c){function d(a,b){var d=a[0],e=a[1];h[d]={connect:function(a){return"function"!=typeof a?void console.error("Bad callback given to connect to signal "+d):(h.__objectSignals__[e]=h.__objectSignals__[e]||[],h.__objectSignals__[e].push(a),void(b||"destroyed"===d||c.exec({type:QWebChannelMessageTypes.connectToSignal,object:h.__id__,signal:e})))},disconnect:function(a){if("function"!=typeof a)return void console.error("Bad callback given to disconnect from signal "+d);h.__objectSignals__[e]=h.__objectSignals__[e]||[];var f=h.__objectSignals__[e].indexOf(a);return f===-1?void console.error("Cannot find connection of signal "+d+" to "+a.name):(h.__objectSignals__[e].splice(f,1),void(b||0!==h.__objectSignals__[e].length||c.exec({type:QWebChannelMessageTypes.disconnectFromSignal,object:h.__id__,signal:e})))}}}function e(a,b){var c=h.__objectSignals__[a];c&&c.forEach(function(a){a.apply(a,b)})}function f(a){var b=a[0],d=a[1];h[b]=function(){for(var a,b=[],e=0;e<arguments.length;++e)"function"==typeof arguments[e]?a=arguments[e]:b.push(arguments[e]);c.exec({type:QWebChannelMessageTypes.invokeMethod,object:h.__id__,method:d,args:b},function(b){if(void 0!==b){var c=h.unwrapQObject(b);a&&a(c)}})}}function g(a){var b=a[0],e=a[1],f=a[2];h.__propertyCache__[b]=a[3],f&&(1===f[0]&&(f[0]=e+"Changed"),d(f,!0)),Object.defineProperty(h,e,{configurable:!0,get:function(){var a=h.__propertyCache__[b];return void 0===a&&console.warn('Undefined value in property cache for property "'+e+'" in object '+h.__id__),a},set:function(a){return void 0===a?void console.warn("Property setter for "+e+" called with undefined value!"):(h.__propertyCache__[b]=a,void c.exec({type:QWebChannelMessageTypes.setProperty,object:h.__id__,property:b,value:a}))}})}this.__id__=a,c.objects[a]=this,this.__objectSignals__={},this.__propertyCache__={};var h=this;this.unwrapQObject=function(a){if(a instanceof Array){for(var b=new Array(a.length),d=0;d<a.length;++d)b[d]=h.unwrapQObject(a[d]);return b}if(!a||!a["__QObject*__"]||void 0===a.id)return a;var e=a.id;if(c.objects[e])return c.objects[e];if(!a.data)return void console.error("Cannot unwrap unknown QObject "+e+" without data.");var f=new QObject(e,a.data,c);return f.destroyed.connect(function(){if(c.objects[e]===f){delete c.objects[e];var a=[];for(var b in f)a.push(b);for(var d in a)delete f[a[d]]}}),f.unwrapProperties(),f},this.unwrapProperties=function(){for(var a in h.__propertyCache__)h.__propertyCache__[a]=h.unwrapQObject(h.__propertyCache__[a])},this.propertyUpdate=function(a,b){for(var c in b){var d=b[c];h.__propertyCache__[c]=d}for(var f in a)e(f,a[f])},this.signalEmitted=function(a,b){e(a,b)},b.methods.forEach(f),b.properties.forEach(g),b.signals.forEach(function(a){d(a,!1)});for(var a in b.enums)h[a]=b.enums[a]}var QWebChannelMessageTypes={signal:1,propertyUpdate:2,init:3,idle:4,debug:5,invokeMethod:6,connectToSignal:7,disconnectFromSignal:8,setProperty:9,response:10},QWebChannel=function(a,b){if("object"!=typeof a||"function"!=typeof a.send)return void console.error("The QWebChannel expects a transport object with a send function and onmessage callback property. Given is: transport: "+typeof a+", transport.send: "+typeof a.send);var c=this;this.transport=a,this.send=function(a){"string"!=typeof a&&(a=JSON.stringify(a)),c.transport.send(a)},this.transport.onmessage=function(a){var b=a.data;switch("string"==typeof b&&(b=JSON.parse(b)),b.type){case QWebChannelMessageTypes.signal:c.handleSignal(b);break;case QWebChannelMessageTypes.response:c.handleResponse(b);break;case QWebChannelMessageTypes.propertyUpdate:c.handlePropertyUpdate(b);break;default:console.error("invalid message received:",a.data)}},this.execCallbacks={},this.execId=0,this.exec=function(a,b){return b?(c.execId===Number.MAX_VALUE&&(c.execId=Number.MIN_VALUE),a.hasOwnProperty("id")?void console.error("Cannot exec message with property id: "+JSON.stringify(a)):(a.id=c.execId++,c.execCallbacks[a.id]=b,void c.send(a))):void c.send(a)},this.objects={},this.handleSignal=function(a){var b=c.objects[a.object];b?b.signalEmitted(a.signal,a.args):console.warn("Unhandled signal: "+a.object+"::"+a.signal)},this.handleResponse=function(a){return a.hasOwnProperty("id")?(c.execCallbacks[a.id](a.data),void delete c.execCallbacks[a.id]):void console.error("Invalid response message received: ",JSON.stringify(a))},this.handlePropertyUpdate=function(a){for(var b in a.data){var d=a.data[b],e=c.objects[d.object];e?e.propertyUpdate(d.signals,d.properties):console.warn("Unhandled property update: "+d.object+"::"+d.signal)}c.exec({type:QWebChannelMessageTypes.idle})},this.debug=function(a){c.send({type:QWebChannelMessageTypes.debug,data:a})},c.exec({type:QWebChannelMessageTypes.init},function(a){for(var d in a)var e=new QObject(d,a[d],c);for(var d in c.objects)c.objects[d].unwrapProperties();b&&b(c),c.exec({type:QWebChannelMessageTypes.idle})})};"object"==typeof module&&(module.exports={QWebChannel:QWebChannel});var TOTVS;!function(a){var b=function(){function a(a,b){if(void 0!==window.Promise?this.__send=this.__send_promise:this.__send=this.__send_callback,this.internalWSPort=a,this.internalWSPort){var c=this,d="ws://127.0.0.1:"+this.internalWSPort,e=new WebSocket(d);e.onclose=function(){console.error("WebChannel closed")},e.onerror=function(a){console.error("WebChannel error: "+a)},e.onopen=function(){c.qwebchannel=new QWebChannel(e,function(a){c.dialog=a.objects.mainDialog,c.dialog.advplToJs.connect(function(a,b,c){if("js"==a){var d=document.createElement("script");d.setAttribute("type","text/javascript"),d.innerText=b,document.getElementsByTagName("head")[0].appendChild(d)}else if("css"==a){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.innerText=b,document.getElementsByTagName("head")[0].appendChild(e)}}),"function"==typeof b&&b()})}}}return a.prototype.runAdvpl=function(a,b){return this.__send("runAdvpl",a,b)},a.prototype.getPicture=function(a){return this.__send("getPicture","",a)},a.prototype.barCodeScanner=function(a){return this.__send("barCodeScanner","",a)},a.prototype.pairedDevices=function(a){return this.__send("pairedDevices","",a)},a.prototype.unlockOrientation=function(a){return this.__send("unlockOrientation","",a)},a.prototype.lockOrientation=function(a){return this.__send("lockOrientation","",a)},a.prototype.getCurrentPosition=function(a){return this.__send("getCurrentPosition","",a)},a.prototype.testDevice=function(a,b){return this.__send("testDevice",String(a),b)},a.prototype.createNotification=function(a,b){return this.__send("createNotification",a,b)},a.prototype.openSettings=function(a,b){return this.__send("openSettings",String(a),b)},a.prototype.getTempPath=function(a){return this.__send("getTempPath","",a)},a.prototype.vibrate=function(a,b){return this.__send("vibrate",a,b)},a.prototype.dbGet=function(a,b){return this.__send("dbGet",a,b)},a.prototype.dbExec=function(a,b){return this.__send("dbExec",a,b)},a.prototype.dbExecuteScalar=function(a,b){return this.__send("DBEXECSCALAR",a,b)},a.prototype.dbBegin=function(a){return this.__send("dbBegin","",a)},a.prototype.dbCommit=function(a,b){return this.__send("dbCommit","",a)},a.prototype.dbRollback=function(a){return this.__send("dbRollback","",a)},a.prototype.sendMessage=function(a,b){return this.__send("MESSAGE",a,b)},a.prototype.__send_promise=function(a,b,c,d){var e=this,f=new Promise(function(c,d){try{e.dialog.jsToAdvpl(a,e.__JSON_stringify(b),function(a){c(e.__JSON_parse(a))})}catch(a){d(a)}});return c&&"function"==typeof c&&f.then(c),d&&"function"==typeof d&&f.catch(d),f},a.prototype.__send_callback=function(a,b,c,d){var e=this;try{"function"==typeof c?e.dialog.jsToAdvpl(a,e.__JSON_stringify(b),function(a){c(e.__JSON_parse(a))}):e.dialog.jsToAdvpl(a,e.__JSON_stringify(b),null)}catch(a){if(!d||"function"!=typeof d)throw a;d(a)}},a.prototype.__JSON_stringify=function(b){return null===b?null:Array.isArray(b)||"object"==typeof b?a.JSON_FLAG+JSON.stringify(b)+a.JSON_FLAG:b.toString()},a.prototype.__JSON_parse=function(b){if("string"==typeof b){var c=a.JSON_FLAG;if(b.length>=2+2*c.length){var d=c.length,e=b.length-c.length;if(b.substr(0,d)===c&&b.substr(e)===c)return JSON.parse(b.substring(d,e))}}return b},a.version="0.0.10",a.BLUETOOTH_FEATURE=1,a.NFC_FEATURE=2,a.WIFI_FEATURE=3,a.LOCATION_FEATURE=4,a.CONNECTED_WIFI=5,a.CONNECTED_MOBILE=6,a.JSON_FLAG="#JSON#",a}();a.TWebChannel=b}(TOTVS||(TOTVS={}));